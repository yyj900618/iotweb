webpackJsonp([1],{"2KnE":function(e,t){},BwtD:function(e,t){},Cosz:function(e,t){},"E4S+":function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("//Fk"),i=a.n(s),n=a("7+uW"),o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t("router-view")],1)],1)},staticRenderFns:[]};var l=a("VU/8")({name:"app",components:{}},o,!1,function(e){a("nyQt")},null,null).exports,r=a("/ocq"),c=a("TGvd"),d={data:function(){return{sysName:"后台管理系统",menuData:[],collapsed:!1,sysUserName:"管理员"}},methods:{initMenu:function(){for(var e in this.$router.options.routes){var t=this.$router.options.routes[e];if(!t.hidden){var a=[];for(var s in t.children){var i=t.children[s];i.hidden||a.push(i)}a.length<1||(this.menuData.push(t),t.children=a)}}},collapse:function(){this.collapsed=!this.collapsed},showMenu:function(e,t){this.$refs.menuCollapsed.getElementsByClassName("submenu-hook-"+e)[0].style.display=t?"block":"none"},logout:function(){sessionStorage.clear(),this.$router.push({path:"/login"}),this.$axios.post("/api/logout")}},mounted:function(){this.initMenu(),this.sysUserName=sessionStorage.getItem("name")}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"container"},[a("el-col",{staticClass:"header",attrs:{span:24}},[a("el-col",{staticClass:"logo",class:"logo-width",attrs:{span:5}},[a("a",{staticStyle:{"text-decoration":"none",color:"#FFFFFF"},attrs:{href:"/"}},[e._v("\n            "+e._s(e.sysName)+"\n            ")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"tools",on:{click:function(t){return t.preventDefault(),e.collapse(t)}}},[a("i",{staticClass:"fa fa-align-justify"})])]),e._v(" "),a("el-col",{staticClass:"userinfo",attrs:{span:10}},[a("el-dropdown",{attrs:{trigger:"hover"}},[a("span",{staticClass:"el-dropdown-link userinfo-inner"},[e._v("\n                    你好："+e._s(e.sysUserName)+"\n                ")]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[a("a",{attrs:{href:"#/"}},[e._v("首页")])]),e._v(" "),a("el-dropdown-item",[a("a",{on:{click:function(e){}}},[e._v("修改密码")])]),e._v(" "),a("el-dropdown-item",{nativeOn:{click:function(t){e.logout()}}},[e._v("\n                        注销登录\n                    ")])],1)],1)],1)],1),e._v(" "),a("el-col",{staticClass:"main",attrs:{span:24}},[a("aside",{class:e.collapsed?"menu-collapsed":"menu-expanded"},[a("el-menu",{directives:[{name:"show",rawName:"v-show",value:!e.collapsed,expression:"!collapsed"}],staticClass:"el-menu-vertical-demo",style:e.collapsed?{}:{width:"230px"},attrs:{"background-color":"#407db9","text-color":"#fff","active-text-color":"#ffd04b","default-active":e.$route.path,"unique-opened":"",router:""}},[e._l(e.menuData,function(t,s){return t.hidden?e._e():[t.leaf?e._e():a("el-submenu",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:t.meta.permission,expression:"item.meta.permission"}],attrs:{index:s+""}},[a("template",{slot:"title"},[a("i",{class:t.iconCls}),e._v(e._s(t.name)+"\n                        ")]),e._v(" "),e._l(t.children,function(t){return t.hidden?e._e():a("el-menu-item",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:t.meta.permission,expression:"child.meta.permission"}],key:t.path,attrs:{index:t.path}},[e._v("\n                            "+e._s(t.name)+"\n                        ")])})],2),e._v(" "),t.leaf&&t.children.length>0?a("el-menu-item",{attrs:{index:t.children[0].path}},[a("i",{class:t.iconCls}),e._v(e._s(t.children[0].name)+"\n                    ")]):e._e()]})],2),e._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:e.collapsed,expression:"collapsed"}],ref:"menuCollapsed",staticClass:"el-menu el-menu-vertical-demo collapsed el-menu-collapsed"},e._l(e.menuData,function(t,s){return t.hidden?e._e():a("li",{staticClass:"el-submenu item"},[t.leaf?[a("li",{staticClass:"el-submenu"},[a("div",{staticClass:"el-submenu__title el-menu-item",class:e.$route.path==t.children[0].path?"is-active":"",staticStyle:{"padding-left":"20px",height:"56px","line-height":"56px",padding:"0 20px"},on:{click:function(a){e.$router.push(t.children[0].path)}}},[a("i",{class:t.iconCls})])])]:[a("div",{staticClass:"el-submenu__title",staticStyle:{"padding-left":"20px"},on:{mouseover:function(t){e.showMenu(s,!0)},mouseout:function(t){e.showMenu(s,!1)}}},[a("i",{class:t.iconCls})]),e._v(" "),a("ul",{staticClass:"el-menu submenu",class:"submenu-hook-"+s,on:{mouseover:function(t){e.showMenu(s,!0)},mouseout:function(t){e.showMenu(s,!1)}}},e._l(t.children,function(t){return t.hidden?e._e():a("li",{key:t.path,staticClass:"el-menu-item",class:e.$route.path==t.path?"is-active":"",staticStyle:{"padding-left":"40px",color:"#fff"},on:{click:function(a){e.$router.push(t.path)}}},[e._v("\n                                "+e._s(t.name)+"\n                            ")])}))]],2)}))],1),e._v(" "),a("section",{staticClass:"content-container"},[a("div",{staticClass:"grid-content bg-purple-light"},[a("el-col",{staticClass:"breadcrumb-container",attrs:{span:24}},[a("strong",{staticClass:"title"},[e._v(e._s(e.$route.name))]),e._v(" "),a("el-breadcrumb",{staticClass:"breadcrumb-inner",attrs:{separator:"/"}},e._l(e.$route.matched,function(t){return a("el-breadcrumb-item",{key:t.path},[e._v("\n                            "+e._s(t.name)+"\n                        ")])}))],1),e._v(" "),a("el-col",{staticClass:"content-wrapper",attrs:{span:24}},[a("transition",{attrs:{name:"fade",mode:"out-in"}},[a("router-view")],1)],1)],1)])])],1)},staticRenderFns:[]};var u=a("VU/8")(d,p,!1,function(e){a("R3oS")},null,null).exports,h=a("mvHQ"),v=a.n(h),m={data:function(){return{loginname:"",password:"",ispassword:!0}},methods:{handleLogin:function(){var e=this;console.log("登录按钮");var t=new URLSearchParams;t.append("loginname",this.loginname),t.append("password",this.password),this.$axios({method:"post",url:"/api/login",params:t}).then(function(t){if(console.log(t),0==t.data.code){var a=t.data.data.id;sessionStorage.setItem("userid_login",t.data.data.id);var s=v()(t.data.data.permissionList);sessionStorage.setItem("permissionStr",s),sessionStorage.setItem("roletype",t.data.data.roletype),sessionStorage.setItem("companyid",t.data.data.companyid),sessionStorage.setItem("name",t.data.data.name),e.$store.commit("login",a),e.$router.push({path:"/main"})}else e.$message({type:"error",message:t.data.msg+":"+t.data.data})})},showpassword:function(){this.ispassword=!this.ispassword},handlecheck:function(){console.log("检查按钮");var e=this.$store.getters.getisloginById(2);console.log(e)}}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loginbackgound"},[a("h1",{staticClass:"logintitle"},[e._v("欢迎登录后台系统")]),e._v(" "),a("div",{staticClass:"logintable"},[a("p",{staticStyle:{"text-align":"center","margin-top":"60px"}},[a("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:" 请输入用户名"},model:{value:e.loginname,callback:function(t){e.loginname=t},expression:"loginname"}},[a("i",{staticClass:"el-input__icon fa fa-id-card fa-lg",attrs:{slot:"prefix","aria-hidden":"true"},slot:"prefix"})])],1),e._v(" "),a("p",{staticStyle:{"text-align":"center","margin-bottom":"60px"}},[this.ispassword?a("el-input",{staticStyle:{width:"250px"},attrs:{type:"password",placeholder:" 请输入密码"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleLogin(t):null}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}},[a("i",{staticClass:"el-input__icon fa fa-key fa-lg",attrs:{slot:"prefix","aria-hidden":"true"},slot:"prefix"}),e._v(" "),a("i",{staticClass:"el-input__icon fa fa-eye fa-lg",attrs:{slot:"suffix","aria-hidden":"true"},on:{click:function(t){e.showpassword()}},slot:"suffix"})]):e._e(),e._v(" "),this.ispassword?e._e():a("el-input",{staticStyle:{width:"250px"},attrs:{type:"text",placeholder:" 请输入密码"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleLogin(t):null}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}},[a("i",{staticClass:"el-input__icon fa fa-key fa-lg",attrs:{slot:"prefix","aria-hidden":"true"},slot:"prefix"}),e._v(" "),a("i",{staticClass:"el-input__icon fa fa-eye-slash fa-lg",attrs:{slot:"suffix","aria-hidden":"true"},on:{click:function(t){e.showpassword()}},slot:"suffix"})])],1),e._v(" "),a("el-button",{staticStyle:{width:"300px"},attrs:{type:"primary"},on:{click:function(t){e.handleLogin()}}},[e._v("登录")])],1)])},staticRenderFns:[]};var f=a("VU/8")(m,_,!1,function(e){a("npDf")},null,null).exports,y=a("NYxO");n.default.use(y.a);var g=new y.a.Store({state:{user:{}},mutations:{login:function(e,t){e.user.id=t,e.user.islogin=!0,sessionStorage.setItem("user",v()(e.user))}},actions:{login:function(e){e.commit("login")}},getters:{getisloginById:function(e){return function(t){if(void 0!=e.user.id&&void 0!=e.user.islogin)return t==e.user.id?e.user:{id:t,islogin:!1};var a=sessionStorage.getItem("user");if(""!==a&&null!=a&&void 0!=a){var s=JSON.parse(a);return t==s.id?(e.user=s,e.user):{id:t,islogin:!1}}return null}}}}),b={data:function(){return{tableData:[],search:"",loginname:"",name:"",phonenum:"",options:[{value:"1",label:"有效"},{value:"0",label:"禁用"}],isvalid:""}},methods:{handleEdit:function(e,t){console.log("点击了编辑用户按钮"),this.$router.push({path:"/system/ContractEdit",query:{index:e,row:t}})},addUser:function(e,t){console.log("点击了新增用户按钮"),this.$router.push({path:"/system/ContractAdd",query:{index:e,row:t}})},handleDelete:function(e,t){var a=this,s=new URLSearchParams;""!=t.id&&null!=t.id&&s.append("userid",t.id),this.$axios.post("/api/user/removeuserbyid",s).then(function(t){1==t.data.data?(a.tableData.splice(e,1),console.log("删除成功")):console.log("删除失败")})},handleSearch:function(){var e=this,t=new URLSearchParams;""!=this.loginname&&null!=this.loginname&&t.append("loginname",this.loginname),""!=this.name&&null!=this.name&&t.append("name",this.name),""!=this.phonenum&&null!=this.phonenum&&t.append("phonenum",this.phonenum),""!=this.isvalid&&null!=this.isvalid&&t.append("isvalid",this.isvalid),this.$axios.post("/api/user/getuserlist",t).then(function(t){console.log(t.data.data),e.tableData=t.data.data})},getRowClass:function(e){e.row,e.column;var t=e.rowIndex;e.columnIndex;if(0===t)return"background-color: #F7F6Fd;color: #606266;font-weight: 500;"},tableRowStyle:function(e){e.row,e.rowIndex;return"background-color: #F7F6Fd"}},created:function(){var e=this,t=sessionStorage.getItem("roletype"),a=new URLSearchParams;1!=t&&a.append("companyid",sessionStorage.getItem("companyid")),this.$axios.post("/api/user/getuserlist",a).then(function(t){e.tableData=t.data.data})}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{attrs:{id:"search"}},[e._v("\n     登录名: "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入登录名",clearable:""},model:{value:e.loginname,callback:function(t){e.loginname=t},expression:"loginname"}}),e._v("\n     姓名:  "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入用户姓名",clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v("\n     电话:  "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入联系电话",clearable:""},model:{value:e.phonenum,callback:function(t){e.phonenum=t},expression:"phonenum"}}),e._v("\n     状态: "),a("el-select",{staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"请选择状态"},model:{value:e.isvalid,callback:function(t){e.isvalid=t},expression:"isvalid"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){e.handleSearch()}}},[e._v("搜索")]),e._v(" "),a("p",{staticStyle:{"text-align":"right"}},[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:add",expression:"'system:user:add'"}],attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(t){e.addUser()}}},[e._v("新增")])],1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableData.filter(function(t){return!e.search||t.name.toLowerCase().includes(e.search.toLowerCase())}),"header-cell-style":e.getRowClass,"row-style":e.tableRowStyle}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"姓名"}},[a("span",[e._v(e._s(t.row.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"用户ID"}},[a("span",[e._v(e._s(t.row.id))])]),e._v(" "),a("el-form-item",{attrs:{label:"登录名"}},[a("span",[e._v(e._s(t.row.loginname))])]),e._v(" "),a("el-form-item",{attrs:{label:"联系电话"}},[a("span",[e._v(e._s(t.row.phonenum))])]),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("span",[e._v(e._s(t.row.createtime))])]),e._v(" "),a("el-form-item",{attrs:{label:"更新时间"}},[a("span",[e._v(e._s(t.row.updatetime))])]),e._v(" "),a("el-form-item",{attrs:{label:"是否有效"}},[1==t.row.isvalid?a("span",[e._v("有效")]):e._e(),e._v(" "),1!=t.row.isvalid?a("span",[e._v("无效")]):e._e()]),e._v(" "),a("el-form-item",{attrs:{label:"角色类型"}},[1==t.row.roletype?a("span",[e._v("超级管理员")]):e._e(),e._v(" "),1!=t.row.roletype?a("span",[e._v("普通人员")]):e._e()])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"用户ID",prop:"id"}}),e._v(" "),a("el-table-column",{attrs:{label:"姓名",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:"联系电话",prop:"phonenum"}}),e._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-input",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:view",expression:"'system:user:view'"}],attrs:{size:"mini",placeholder:"姓名过滤"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:update",expression:"'system:user:update'"}],attrs:{size:"mini"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:delete",expression:"'system:user:delete'"}],attrs:{size:"mini",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1)},staticRenderFns:[]};var w=a("VU/8")(b,x,!1,function(e){a("Cosz")},null,null).exports,k={data:function(){return{tableData:[],search:""}},methods:{handleEdit:function(e,t){console.log("点击了编辑角色按钮"),this.$router.push({path:"/system/RoleEdit",query:{index:e,row:t}})},handleDelete:function(e,t){var a=this;this.$confirm("是否确认删除该角色，删除角色后将导致属于该角色的人员权限不可用，请慎重操作","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s=new URLSearchParams;""!=t.id&&null!=t.id&&s.append("roleid",t.id),a.$axios.post("/api/role/removerolebyid",s).then(function(t){1==t.data.data?(a.tableData.splice(e,1),console.log("删除成功")):console.log("删除失败")})}).catch(function(){a.$message({type:"info",message:"已取消"})})},addrole:function(){console.log("点击了新增角色按钮"),this.$router.push({path:"/system/RoleAdd"})},getRowClass:function(e){e.row,e.column;var t=e.rowIndex;e.columnIndex;if(0===t)return"background-color: #F7F6Fd;color: #606266;font-weight: 500;"},tableRowStyle:function(e){e.row,e.rowIndex;return"background-color: #F7F6Fd"}},created:function(){var e=this,t=sessionStorage.getItem("roletype"),a=new URLSearchParams;a.append("roletype",t),this.$axios({method:"post",url:"/api/role/rolelist",params:a}).then(function(t){e.tableData=t.data.data,console.log(e.tableData)})}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("p",{staticStyle:{"text-align":"right"}},[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:add",expression:"'system:user:add'"}],attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(t){e.addrole()}}},[e._v("新增")])],1),e._v(" "),a("el-table",{attrs:{data:e.tableData.filter(function(t){return!e.search||t.rolename.toLowerCase().includes(e.search.toLowerCase())}),"header-cell-style":e.getRowClass,"row-style":e.tableRowStyle}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"ID"}},[a("span",[e._v(e._s(t.row.id))])]),e._v(" "),a("el-form-item",{attrs:{label:"角色名"}},[a("span",[e._v(e._s(t.row.rolename))])]),e._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("span",[e._v(e._s(t.row.description))])]),e._v(" "),a("el-form-item",{attrs:{label:"角色类型"}},[1==t.row.roletype?a("span",[e._v("管理员")]):e._e(),e._v(" "),1!=t.row.roletype?a("span",[e._v("普通")]):e._e()]),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("span",[e._v(e._s(t.row.createtime))])]),e._v(" "),a("el-form-item",{attrs:{label:"更新时间"}},[a("span",[e._v(e._s(t.row.updatetime))])]),e._v(" "),a("el-form-item",{attrs:{label:"是否有效"}},[1==t.row.isvalid?a("span",[e._v("有效")]):e._e(),e._v(" "),1!=t.row.isvalid?a("span",[e._v("无效")]):e._e()]),e._v(" "),a("el-form-item",{attrs:{label:"当前权限列表"}},e._l(t.row.authList,function(t){return a("span",[e._v(e._s(t)),a("br")])}))],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"角色ID",prop:"id"}}),e._v(" "),a("el-table-column",{attrs:{label:"描述",prop:"description"}}),e._v(" "),a("el-table-column",{attrs:{label:"角色类型",prop:"roletype"}}),e._v(" "),a("el-table-column",{attrs:{label:"角色名",prop:"rolename"}}),e._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-input",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:view",expression:"'system:user:view'"}],attrs:{size:"mini",placeholder:"姓名过滤"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:update",expression:"'system:user:update'"}],attrs:{size:"mini"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system:user:delete",expression:"'system:user:delete'"}],attrs:{size:"mini",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1)},staticRenderFns:[]};var $=a("VU/8")(k,S,!1,function(e){a("ntd3")},"data-v-0395da84",null).exports,C={data:function(){return{row:{},user:{},options:[],checkAll:!1,checkedRoles:[],roles:[],isIndeterminate:!0}},methods:{submit:function(){var e=this,t=this.checkvalues();console.log(t),t.then(function(t){console.log("resolve:"+t),e.updateuser()},function(e){console.log(e)}).catch(function(e){console.log(e)})},updateuser:function(){var e=this;console.log("进入submit1"),this.$confirm("是否确认提交","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t="";e.checkedRoles.forEach(function(e){t+=","+e}),-1!=e.checkedRoles.indexOf(1)?e.user.roletype=1:e.user.roletype=2,t=t.replace(/^,+/,"").replace(/,+$/,"");var a=new URLSearchParams;a.append("userid",e.user.id),a.append("name",e.user.name),a.append("password",e.user.password),a.append("phonenum",e.user.phonenum),a.append("companyid",e.user.companyid),a.append("roleids",t),a.append("roletype",e.user.roletype),e.$axios.post("/api/user/updateuserbyid",a).then(function(t){0==t.data.code?e.$message({type:"success",message:t.data.msg}):e.$message({type:"error",message:t.data.msg})})}).catch(function(){e.$message({type:"info",message:"已取消修改"})})},back:function(){this.$router.go(-1)},handleCheckAllChange:function(e){if(e){var t=[];this.roles.forEach(function(e){t.push(e.id)}),this.checkedRoles=t}else this.checkedRoles=[];this.isIndeterminate=!1},handleCheckedRolesChange:function(e){console.log(e);var t=e.length;this.roles.length==t?this.checkAll=!0:this.checkAll=!1,this.isIndeterminate=t>0&&t<this.roles.length},checkvalues:function(){if(console.log("companyid:"+this.user.companyid),1!=this.user.companyid)for(var e in this.checkedRoles)if(1==this.checkedRoles[e])return this.$message({type:"error",message:"超级管理员必须属于超管公司"}),i.a.reject(-1);return i.a.resolve(1)},initcompany:function(){var e=this,t=sessionStorage.getItem("roletype"),a=new URLSearchParams;1!=t&&a.append("companyid",sessionStorage.getItem("companyid")),this.$axios.post("/api/company/getcompanylist",a).then(function(t){t.data.data.forEach(function(t){1==t.isvalid&&e.options.push({label:t.companyname,key:t.id,value:t.id})}),e.initrolelist()})},initrolelist:function(){var e=this,t=sessionStorage.getItem("roletype"),a=new URLSearchParams;a.append("roletype",t),this.$axios({method:"post",url:"/api/role/rolelist",params:a}).then(function(t){var a=t.data.data;e.roles=a,e.inituser()}).catch(function(t){console.log(t),e.$message({type:"error",message:t})})},inituser:function(){var e=this;this.row=this.$route.query.row;var t=new URLSearchParams;""!=this.row.id&&null!=this.row.id&&void 0!=this.row.id?(sessionStorage.setItem("userid",this.row.id),t.append("userid",this.row.id)):t.append("userid",sessionStorage.getItem("userid")),this.$axios.post("/api/user/getuserbyid",t).then(function(t){e.user=t.data.data,e.user.password="",t.data.data.roleids.split(",").forEach(function(t){e.checkedRoles.push(Number(t))})})}},created:function(){this.initcompany()}},R={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",{staticStyle:{"text-align":"center"}},[e._v("角色修改页面")]),e._v(" "),a("div",{staticStyle:{"text-align":"left"}},[a("p",[a("span",{staticClass:"title"},[e._v("登录名：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{disabled:!0},model:{value:e.user.loginname,callback:function(t){e.$set(e.user,"loginname",t)},expression:"user.loginname"}})],1),e._v(" "),a("p",[a("span",{staticClass:"title"},[e._v(" 姓名：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入用户姓名"},model:{value:e.user.name,callback:function(t){e.$set(e.user,"name",t)},expression:"user.name"}})],1),e._v(" "),a("p"),e._v(" "),a("span",{staticClass:"title"},[e._v(" 联系电话：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入联系电话"},model:{value:e.user.phonenum,callback:function(t){e.$set(e.user,"phonenum",t)},expression:"user.phonenum"}}),e._v(" "),a("p"),e._v(" "),a("p",[a("span",{staticClass:"title"},[e._v(" 密码：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入密码："},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password",t)},expression:"user.password"}}),a("br")],1),e._v(" "),a("p",[a("span",{staticClass:"title"},[e._v("公司")]),e._v(" "),a("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.user.companyid,callback:function(t){e.$set(e.user,"companyid",t)},expression:"user.companyid"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")])],1),a("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedRolesChange},model:{value:e.checkedRoles,callback:function(t){e.checkedRoles=t},expression:"checkedRoles"}},e._l(e.roles,function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.description))])})),e._v(" "),a("p"),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e.back()}}},[e._v("返回")])],1)])},staticRenderFns:[]};var I={data:function(){return{loginname:"",password:"",phonenum:"",name:"",roletype:2,companyid:"",options:[],checkAll:!1,checkedRoles:[],roles:[],isIndeterminate:!0}},methods:{handleCheckAllChange:function(e){if(e){var t=[];this.roles.forEach(function(e){t.push(e.id)}),this.checkedRoles=t}else this.checkedRoles=[];this.isIndeterminate=!1},handleCheckedRolesChange:function(e){var t=e.length;this.roles.length==t?this.checkAll=!0:this.checkAll=!1,this.isIndeterminate=t>0&&t<this.roles.length},submit:function(){console.log("进入submit");var e=this,t=this.checkvalues();console.log(t),t.then(function(t){console.log("resolve:"+t),e.adduser()},function(e){console.log(e)}).catch(function(e){console.log(e)})},adduser:function(){var e=this,t="",a=new URLSearchParams;this.checkedRoles.forEach(function(a){t+=a+",",1==a&&(e.roletype=1)}),t=t.replace(/^,+/,"").replace(/,+$/,""),this.checkedRoles.forEach(function(e){t+=","+e}),-1!=this.checkedRoles.indexOf(1)?this.roletype=1:this.roletype=2,t=t.replace(/^,+/,"").replace(/,+$/,""),a.append("loginname",this.loginname),a.append("password",this.password),a.append("phonenum",this.phonenum),a.append("name",this.name),a.append("companyid",this.companyid),a.append("roleids",t),a.append("roletype",this.roletype),this.$axios({method:"post",url:"/api/user/adduser",params:a}).then(function(t){0==t.data.code?e.$message({type:"success",message:t.data.msg}):e.$message({type:"error",message:t.data.msg})}).catch(function(t){console.log(t),e.$message({type:"error",message:t})})},checkvalues:function(){if(console.log("companyid:"+this.companyid),1!=this.companyid)for(var e in this.checkedRoles)if(1==this.checkedRoles[e])return this.$message({type:"error",message:"超级管理员必须属于超管公司"}),i.a.reject(-1);return i.a.resolve(1)}},created:function(){var e=this,t=sessionStorage.getItem("roletype"),a=new URLSearchParams;1!=t&&a.append("companyid",sessionStorage.getItem("companyid")),this.$axios.post("/api/company/getcompanylist",a).then(function(t){t.data.data.forEach(function(t){1==t.isvalid&&e.options.push({label:t.companyname,key:t.id,value:t.id})})}).catch(function(t){console.log(t),e.$message({type:"error",message:t})});var s=new URLSearchParams;s.append("roletype",t),this.$axios({method:"post",url:"/api/role/rolelist",params:s}).then(function(t){var a=t.data.data;console.log(a),e.roles=a}).catch(function(t){console.log(t),e.$message({type:"error",message:t})})}},P={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("添加用户")]),e._v(" "),a("div",{staticStyle:{"text-align":"left"}},[a("p",[a("span",{staticClass:"myusertitle"},[e._v("登录名")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入登录名"},model:{value:e.loginname,callback:function(t){e.loginname=t},expression:"loginname"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myusertitle"},[e._v("密码")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备描述"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myusertitle"},[e._v("手机号码")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入手机号码"},model:{value:e.phonenum,callback:function(t){e.phonenum=t},expression:"phonenum"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myusertitle"},[e._v("姓名")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入姓名"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myusertitle"},[e._v("公司")]),e._v(" "),a("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.companyid,callback:function(t){e.companyid=t},expression:"companyid"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")])],1),a("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedRolesChange},model:{value:e.checkedRoles,callback:function(t){e.checkedRoles=t},expression:"checkedRoles"}},e._l(e.roles,function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.description))])})),e._v(" "),a("p"),e._v(" "),a("p",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("提交")])],1)],1)])},staticRenderFns:[]};var D={data:function(){return{rolename:"",description:"",options:[{value:1,label:"管理员"},{value:2,label:"普通"}],roletype:"",authtree:[],defaultProps:{children:"children",label:"label"}}},methods:{getCheckedKeys:function(){console.log(this.$refs.tree.getCheckedKeys())},submit:function(){var e=this,t=this.checkvalues();console.log(t),t.then(function(t){console.log("resolve:"+t),e.addrole()},function(e){console.log(e)}).catch(function(e){console.log(e)})},addrole:function(){var e=this,t="",a=this.$refs.tree.getCheckedKeys();console.log("addrole"),console.log(a),a.forEach(function(e){t+=","+e}),t=t.replace(/^,+/,"").replace(/,+$/,"");var s=new URLSearchParams;s.append("roletype",this.roletype),s.append("rolename",this.rolename),s.append("description",this.description),s.append("auth",t),this.$axios.post("/api/role/addrole",s).then(function(t){0==t.data.code?e.$message({type:"success",message:t.data.msg}):e.$message({type:"error",message:t.data.msg})})},checkvalues:function(){var e=this.$refs.tree.getCheckedKeys();return console.log("checekvalues"),console.log(e),0==e.length||""==this.rolename||""==this.description||""==this.roletype?(this.$message({type:"error",message:"必填项不能为空"}),i.a.reject(-1)):i.a.resolve(1)},back:function(){this.$router.go(-1)}},created:function(){var e=this;this.$axios({method:"post",url:"/api/role/getallauth"}).then(function(t){var a=t.data.data;console.log(a),a.forEach(function(t){e.authtree.push({id:t.id,label:t.description,children:[]})})})}},E={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("添加角色")]),e._v(" "),a("p",[a("span",{staticClass:"myroleaddtitle"},[e._v("角色名")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入角色名"},model:{value:e.rolename,callback:function(t){e.rolename=t},expression:"rolename"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myroleaddtitle"},[e._v("描述")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输描述"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myroleaddtitle"},[e._v("角色类型")]),e._v(" "),a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},model:{value:e.roletype,callback:function(t){e.roletype=t},expression:"roletype"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myroleaddtitle"},[e._v("权限")]),e._v(" "),a("el-tree",{ref:"tree",staticStyle:{"background-color":"#d3d7d4",width:"200px","margin-left":"70px"},attrs:{data:e.authtree,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:e.defaultProps}})],1),e._v(" "),a("p",[a("el-button",{staticStyle:{"margin-left":"70px"},attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e.back()}}},[e._v("返回")])],1)])},staticRenderFns:[]};var U={data:function(){return{roleid:"",rolename:"",description:"",options:[{value:1,label:"管理员"},{value:2,label:"普通"}],roletype:"",authtree:[],defaultProps:{children:"children",label:"label"}}},methods:{getCheckedKeys:function(){console.log(this.$refs.tree.getCheckedKeys())},setCheckedKeys:function(e){console.log("进入设置权限"),this.$refs.tree.setCheckedKeys(e)},submit:function(){var e=this,t=this.checkvalues();console.log(t),t.then(function(t){console.log("resolve:"+t),e.updaterole()},function(e){console.log(e)}).catch(function(e){console.log(e)})},updaterole:function(){var e=this,t="",a=this.$refs.tree.getCheckedKeys();console.log("addrole"),console.log(a),a.forEach(function(e){t+=","+e}),t=t.replace(/^,+/,"").replace(/,+$/,"");var s=new URLSearchParams;s.append("roleid",this.roleid),s.append("roletype",this.roletype),s.append("rolename",this.rolename),s.append("description",this.description),s.append("auth",t),this.$axios.post("/api/role/updaterole",s).then(function(t){0==t.data.code?e.$message({type:"success",message:t.data.msg}):e.$message({type:"error",message:t.data.msg})})},checkvalues:function(){var e=this.$refs.tree.getCheckedKeys();return console.log("checekvalues"),console.log(e),0==e.length||""==this.rolename||""==this.description||""==this.roletype?(this.$message({type:"error",message:"必填项不能为空"}),i.a.reject(-1)):i.a.resolve(1)},back:function(){this.$router.go(-1)},initauthlist:function(){var e=this;this.$axios({method:"post",url:"/api/role/getallauth"}).then(function(t){var a=t.data.data;console.log(a),a.forEach(function(t){e.authtree.push({id:t.id,label:t.description,children:[]})}),e.initcheckedauth()})},initcheckedauth:function(){var e=this,t=this.$route.query.row,a=[],s=new URLSearchParams;""!=t.id&&void 0!=t.id&&null!=t.id?(sessionStorage.setItem("roleid",t.id),s.append("roleid",t.id)):s.append("roleid",sessionStorage.getItem("roleid")),this.$axios.post("/api/role/getrolebyid",s).then(function(t){e.roleid=t.data.data.id,e.rolename=t.data.data.rolename,e.description=t.data.data.description,e.roletype=t.data.data.roletype,a=t.data.data.auth.split(","),console.log(a),e.setCheckedKeys(a)})}},created:function(){this.initauthlist()}},N={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("添加角色")]),e._v(" "),a("p",[a("span",{staticClass:"myroleedittitle"},[e._v("角色名")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入角色名"},model:{value:e.rolename,callback:function(t){e.rolename=t},expression:"rolename"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myroleedittitle"},[e._v("描述")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输描述"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myroleedittitle"},[e._v("角色类型")]),e._v(" "),a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},model:{value:e.roletype,callback:function(t){e.roletype=t},expression:"roletype"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"myroleedittitle"},[e._v("权限")]),e._v(" "),a("el-tree",{ref:"tree",staticStyle:{"background-color":"#d3d7d4",width:"200px","margin-left":"70px"},attrs:{data:e.authtree,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:e.defaultProps}})],1),e._v(" "),a("p",[a("el-button",{staticStyle:{"margin-left":"70px"},attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e.back()}}},[e._v("返回")])],1)])},staticRenderFns:[]};var F=[{path:"/system",name:"系统中心",component:u,iconCls:"fa fa-address-card",meta:{permission:"system:user:view|system:user:delete|system:user:add|system:user:update"},children:[{path:"/system/contract",component:w,meta:{permission:"system:user:view"},name:"用户列表"},{path:"/system/ContractEdit",component:a("VU/8")(C,R,!1,function(e){a("sg/Y")},null,null).exports,name:"用户编辑",hidden:!0},{path:"/system/ContractAdd",component:a("VU/8")(I,P,!1,function(e){a("XMWq")},"data-v-61e502cc",null).exports,name:"用户新增",hidden:!0},{path:"/system/role",component:$,meta:{permission:"system:role:view"},name:"角色列表"},{path:"/system/RoleAdd",component:a("VU/8")(D,E,!1,function(e){a("iLAA")},"data-v-54b93c09",null).exports,name:"角色添加",hidden:!0},{path:"/system/RoleEdit",component:a("VU/8")(U,N,!1,function(e){a("RBB8")},"data-v-84d3f8a4",null).exports,name:"角色修改",hidden:!0}]}],L={data:function(){return{roletype:"",tableData:[],search:"",deviceID:"",title:"",online:"",total_count:0,page:1,per_page:8,companylist:[],companyid:"",options:[{value:"1",label:"在线"},{value:"0",label:"离线"}]}},methods:{handleCurrentChange:function(e){console.log("当前页:"+e),this.page=e,this.refesh()},handlePrePage:function(){console.log("点击上一页"),this.page=this.page-1},handleNextPage:function(){console.log("点击下一页"),this.page=this.page+1},handleSearch:function(){this.page=1,this.refesh()},handleEdit:function(e,t){console.log("点击了编辑按钮"),this.$router.push({path:"/device/edit",query:{index:e,row:t}})},handleSendcmd:function(e,t){console.log("点击了下发命令按钮"),this.$router.push({path:"/device/sendcmd",query:{index:e,row:t}})},handleView:function(e,t){this.$router.push({path:"/device/dto",query:{index:e,row:t}}),console.log("点击了详情按钮")},addDevice:function(){console.log("点击了添加设备按钮"),this.$router.push({path:"/device/adddevice"})},handleDelete:function(e,t){var a=this;console.log("点击了删除按钮");var s=t.id,i="/iot/devices/"+s;this.$confirm("是否确认删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=new URLSearchParams;e.append("deviceid",s),a.$axios({method:"post",url:"/api/device/deletedevice",params:e}).then(function(e){0==e.data.code?a.$axios.delete(i).then(function(e){"succ"==e.data.error?(a.$message({type:"success",message:"删除成功"}),a.refesh()):a.$message({type:"error",message:"删除失败"})}):a.$message({type:"error",message:"删除失败"})})}).catch(function(){a.$message({type:"info",message:"取消"})})},getRowClass:function(e){e.row,e.column;var t=e.rowIndex;e.columnIndex;if(0===t)return"background-color: #F7F6Fd;color: #606266;font-weight: 500;"},tableRowStyle:function(e){e.row,e.rowIndex;return"background-color: #F7F6Fd"},refesh:function(){var e=this;console.log("应用当前参数刷新页面");var t=new URLSearchParams;t.append("pagesize",this.per_page),t.append("pagenum",this.page),""!=this.title&&null!=this.title&&void 0!=this.title&&t.append("title",this.title),""!=this.deviceID&&null!=this.deviceID&&void 0!=this.deviceID&&t.append("device_id",this.deviceID),""!=this.companyid&&null!=this.companyid&&void 0!=this.companyid&&t.append("companyid",this.companyid),this.$axios({method:"post",url:"/api/device/getdevieidlist",params:t}).then(function(t){e.total_count=t.data.data.total;var a="";if(0!=t.data.data.list.length){t.data.data.list.forEach(function(e){a+=e+","}),a=a.replace(/^,+/,"").replace(/,+$/,"");var s={};s.device_id=a,""!=e.online&&"1"==e.online&&(s.online=!0),""!=e.online&&"0"==e.online&&(s.online=!1),e.$axios.get("/iot/devices",{params:s}).then(function(t){console.log(t),e.tableData=t.data.data.devices})}else e.tableData=[]})}},created:function(){var e=this,t=new URLSearchParams;t.append("pagesize",this.per_page),t.append("pagenum",this.page),this.$axios({method:"post",url:"/api/device/getdevieidlist",params:t}).then(function(t){e.total_count=t.data.data.total;var a="";t.data.data.list.forEach(function(e){a+=e+","}),a=a.replace(/^,+/,"").replace(/,+$/,"");var s={};s.device_id=a,e.$axios.get("/iot/devices",{params:s}).then(function(t){e.tableData=t.data.data.devices})});var a=sessionStorage.getItem("roletype"),s=new URLSearchParams;1!=a&&s.append("companyid",sessionStorage.getItem("companyid")),this.$axios.post("/api/company/getcompanylist",s).then(function(t){t.data.data.forEach(function(t){1==t.isvalid&&e.companylist.push({label:t.companyname,key:t.id,value:t.id})})}),this.roletype=sessionStorage.getItem("roletype")}},M={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{attrs:{id:"search"}},[e._v("\n    设备ID: "),a("el-input",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{placeholder:"请输入设备ID",clearable:""},model:{value:e.deviceID,callback:function(t){e.deviceID=t},expression:"deviceID"}}),e._v("\n    设备名："),a("el-input",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{placeholder:"请输入设备名",clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v("\n    状态:\n    "),a("el-select",{staticStyle:{width:"150px","margin-right":"20px"},attrs:{clearable:"",placeholder:"请选择状态"},model:{value:e.online,callback:function(t){e.online=t},expression:"online"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){e.handleSearch()}}},[e._v("搜索")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:add",expression:"'device:add'"}],attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(t){e.addDevice()}}},[e._v("新增")]),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:"1"==e.roletype,expression:"roletype=='1'"}]},[a("span",[e._v("所属公司：")]),e._v(" "),a("el-select",{staticStyle:{width:"150px","margin-right":"20px"},attrs:{clearable:"",placeholder:"请选择所属公司"},model:{value:e.companyid,callback:function(t){e.companyid=t},expression:"companyid"}},e._l(e.companylist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableData.filter(function(t){return!e.search||t.id.toLowerCase().includes(e.search.toLowerCase())}),"header-cell-style":e.getRowClass,"row-style":e.tableRowStyle}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"设备名"}},[a("span",[e._v(e._s(t.row.title))])]),e._v(" "),a("el-form-item",{attrs:{label:"设备ID"}},[a("span",[e._v(e._s(t.row.id))])]),e._v(" "),a("el-form-item",{attrs:{label:"协议"}},[a("span",[e._v(e._s(t.row.protocol))])]),e._v(" "),a("el-form-item",{attrs:{label:"是否在线"}},[t.row.online?a("span",[e._v("在线")]):e._e(),e._v(" "),t.row.online?e._e():a("span",[e._v("离线")])]),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("span",[e._v(e._s(t.row.create_time))])]),e._v(" "),a("el-form-item",{attrs:{label:"认证信息"}},[a("span",[e._v(e._s(t.row.auth_info))])]),e._v(" "),a("el-form-item",{attrs:{label:"设备位置"}},[e._v("\n            经度："),void 0!=t.row.location?a("span",[e._v(e._s(t.row.location.lat))]):e._e(),e._v("\n            纬度："),void 0!=t.row.location?a("span",[e._v(e._s(t.row.location.lon))]):e._e()]),e._v(" "),a("el-form-item",{attrs:{label:"是否私有"}},[t.row.private?a("span",[e._v("私有")]):e._e(),e._v(" "),t.row.private?e._e():a("span",[e._v("公有")])]),e._v(" "),a("el-form-item",{attrs:{label:"标签"}},e._l(t.row.tags,function(t){return a("span",[e._v(e._s(t))])}))],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"设备ID",prop:"id"}}),e._v(" "),a("el-table-column",{attrs:{label:"设备名",prop:"title"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否在线",prop:"online"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.online?a("span",[e._v("在线")]):t.row.online?e._e():a("span",[e._v("离线")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"是否私有",prop:"private"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.private?a("span",[e._v("私有")]):t.row.private?e._e():a("span",[e._v("公有")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-input",{attrs:{size:"mini",placeholder:"设备ID过滤"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),a("br")]}},{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:view",expression:"'device:view'"}],attrs:{size:"mini",icon:"el-icon-document",circle:"",title:"详情"},on:{click:function(a){e.handleView(t.$index,t.row)}}}),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:update",expression:"'device:update'"}],attrs:{size:"mini",type:"primary",icon:"el-icon-edit",circle:"",title:"编辑"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}}),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:cmd",expression:"'device:cmd'"}],attrs:{size:"mini",type:"success",icon:"el-icon-sort",circle:"",title:"下发命令"},on:{click:function(a){e.handleSendcmd(t.$index,t.row)}}}),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:delete",expression:"'device:delete'"}],attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:"",title:"删除"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}})]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"text-align":"center","margin-top":"20px"},attrs:{background:"",layout:"prev, pager, next","current-page":this.page,"page-size":this.per_page,"pager-count":11,total:this.total_count},on:{"current-change":e.handleCurrentChange,"prev-click":e.handlePrePage,"next-click":e.handleNextPage}})],1)},staticRenderFns:[]};var A=a("VU/8")(L,M,!1,function(e){a("2KnE")},null,null).exports,z={data:function(){return{device_id:"",title:"",online:"",cmdvalue:"",timeout:120,row:{},device:{},historycmdlist:[],start:"",end:""}},methods:{back:function(){this.$router.go(-1)},gethistorycmd:function(){var e=this,t={};if(""==this.start||null==this.start||void 0==this.start)return this.$message({type:"error",message:"开始时间必填，请选择开始时间"}),!1;t.start=this.start,""!=this.end&&null!=this.end&&void 0!=this.end&&(t.end=this.end),this.$axios.get("/iot/cmds/history/"+this.device_id,{params:t}).then(function(t){console.log(t),e.historycmdlist=t.data.data.items})},sendonline:function(){var e=this,t=new URLSearchParams;t.append("device_id",this.device_id),this.$axios({method:"post",url:"/iot/cmds",params:t,data:this.cmdvalue}).then(function(t){console.log(t),"succ"==t.data.error?e.$message({type:"success",message:"在线命令下发成功,命令ID为:"+t.data.data.cmd_uuid}):e.$message({type:"error",message:"在线命令下发失败："+t.data.error})})},sendoffline:function(){var e=this,t=new URLSearchParams;t.append("device_id",this.device_id),t.append("qos",1),t.append("timeout",timeout),this.$axios({method:"post",url:"/iot/cmds",params:t,data:this.cmdvalue}).then(function(t){"succ"==t.data.error?e.$message({type:"success",message:"离线命令下发成功,命令ID为:"+t.data.data.cmd_uuid}):e.$message({type:"error",message:"在线命令下发失败："+t.data.error})})}},created:function(){var e=this;this.row=this.$route.query.row;var t={};""!=this.row.id&&null!=this.row.id&&void 0!=this.row.id?(sessionStorage.setItem("device_id",this.row.id),t.device_id=this.row.id):t.device_id=sessionStorage.getItem("device_id"),this.$axios.get("/iot/devices",{params:t}).then(function(t){e.device=t.data.data.devices[0],e.device_id=e.device.id,e.title=e.device.title,e.online=e.device.online})}},j={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("p",[a("span",{staticClass:"mytitle"},[e._v("设备ID：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"设备ID",disabled:!0},model:{value:e.device_id,callback:function(t){e.device_id=t},expression:"device_id"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("设备名：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"设备名",disabled:!0},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("离线命令有效期：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"离线命令有效期"},model:{value:e.timeout,callback:function(t){e.timeout=t},expression:"timeout"}}),e._v(" "),a("span",{staticStyle:{color:"red","margin-left":"10px"}},[e._v("仅对离线命令有效")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("状态：")]),e._v(" "),this.online?a("i",{staticClass:"fa fa-circle",staticStyle:{"font-size":"20px",color:"green"}}):e._e(),e._v(" "),this.online?a("span",{staticStyle:{color:"#343536","font-size":"20px"}},[e._v("在线")]):e._e(),e._v(" "),this.online?e._e():a("i",{staticClass:"fa fa-circle",staticStyle:{"font-size":"20px",color:"red"}}),e._v(" "),this.online?e._e():a("span",{staticStyle:{color:"#343536","font-size":"20px"}},[e._v("离线")])])]),e._v(" "),a("div",[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入命令"},model:{value:e.cmdvalue,callback:function(t){e.cmdvalue=t},expression:"cmdvalue"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("离线命令默认有效期为120秒")])],1),e._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"20px","margin-bottom":"20px"}},[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:cmd",expression:"'device:cmd'"}],attrs:{type:"primary",icon:"el-icon-sort"},on:{click:function(t){e.sendonline()}}},[e._v("在线发送")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:cmd",expression:"'device:cmd'"}],attrs:{type:"info",icon:"el-icon-sort"},on:{click:function(t){e.sendoffline()}}},[e._v("离线发送")])],1),e._v(" "),a("div",[e._v("\n         开始时间: "),a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始日期时间","value-format":"yyyy-MM-ddTHH:mm:ss"},model:{value:e.start,callback:function(t){e.start=t},expression:"start"}}),e._v("\n         结束时间："),a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束日期时间","value-format":"yyyy-MM-ddTHH:mm:ss"},model:{value:e.end,callback:function(t){e.end=t},expression:"end"}}),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"device:cmd",expression:"'device:cmd'"}],attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){e.gethistorycmd()}}},[e._v("获取历史命令")])],1),e._v(" "),a("p",[a("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.historycmdlist,stripe:""}},[a("el-table-column",{attrs:{prop:"cmd_uuid",label:"命令ID",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"confirm_body",label:"confirm_body",width:"240"}}),e._v(" "),a("el-table-column",{attrs:{prop:"confirm_time",label:"confirm_time",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"body",label:"body",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"expire_time",label:"expire_time",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"send_time",label:"send_time",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"status"}})],1)],1),e._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"20px","margin-bottom":"20px"}},[a("el-button",{attrs:{type:"success",icon:"el-icon-caret-left"},on:{click:function(t){e.back()}}},[e._v("返回")])],1)])},staticRenderFns:[]};var B=a("VU/8")(z,j,!1,function(e){a("b6Z5")},null,null).exports,O=a("pFYg"),K=a.n(O),V=a("fZjL"),q=a.n(V),J={data:function(){return{companylist:[],companyid:"",title:"",desc:"",tags:"",lon:-1,lat:-1,private_str:"",options:[{value:"1",label:"私有"},{value:"0",label:"公有"}],auth_info:"",other_str:""}},methods:{handleback:function(){this.$router.go(-1)},handleSummit:function(){console.log("进入提交");var e=this,t=this.checkvalues();console.log(t),t.then(function(t){console.log("resolve:"+t),e.adddevice()},function(e){console.log(e)}).catch(function(e){console.log(e)})},adddevice:function(){var e=this;console.log("进入adddevice");var t=[],a={},s={},i=!0;""!=this.tags&&null!=this.tags&&void 0!=this.tags&&(t=this.tags.split(",")),-1==this.lon&&-1==this.lat||(a.lon=this.lon,a.lat=this.lat),i="0"!=this.private_str;var n=this.other_str.replace(/\s+/g,"");""!=n&&null!=n&&void 0!=n&&(s=JSON.parse(this.other_str));var o={};o.title=this.title,""!=this.desc&&(o.desc=this.desc),0!=t.length&&(o.tags=t),0!=q()(a).length&&(o.location=a),o.private=i,""!=this.auth_info&&(o.auth_info=this.auth_info),0!=q()(s).length&&(o.other=s),this.$axios({method:"post",url:"/iot/devices",data:o}).then(function(t){if("succ"==t.data.error){var a=new URLSearchParams;a.append("deviceid",t.data.data.device_id),a.append("companyid",e.companyid),a.append("title",e.title),e.$axios({method:"post",url:"/api/device/adddevice",params:a}).then(function(a){0==a.data.code?e.$message({type:"success",message:"添加成功，设备ID："+t.data.data.device_id}):(e.$message({type:"error",message:"本地数据库添加失败，进行数据回滚"}),e.$axios.delete("/iot/devices/"+t.data.data.device_id).then(function(a){"succ"==t.data.error?e.$message({type:"error",message:"数据回滚成功"}):e.$message({type:"error",message:"数据回滚失败，请到onenet平台手动删除设备"})}))}).catch(function(a){e.$axios.delete("/iot/devices/"+t.data.data.device_id).then(function(a){"succ"==t.data.error?e.$message({type:"error",message:"本地数据库添加失败，进行数据回滚...数据回滚成功"}):e.$message({type:"error",message:"数据回滚失败，请到onenet平台手动删除设备"})})})}else e.$message({type:"error",message:"添加失败："+t.data.error})})},checkvalues:function(){var e=this.other_str.replace(/\s+/g,"");return""==this.title||null==this.title||void 0==this.title?(this.$message({type:"error",message:"请填入设备名"}),i.a.reject(-1)):""==this.companyid||null==this.companyid||void 0==this.companyid?(this.$message({type:"error",message:"请选择所属公司"}),i.a.reject(-1)):""==e||null==e||void 0==e||this.isJSON(this.other_str)?i.a.resolve(1):(this.$message({type:"error",message:"请输入正确的JSON字符串"}),i.a.reject(-1))},isJSON:function(e){if("string"==typeof e)try{var t=JSON.parse(e);return!("object"!=(void 0===t?"undefined":K()(t))||!t)}catch(t){return console.log("error："+e+"!!!"+t),!1}console.log("It is not a string!")}},created:function(){var e=this,t=sessionStorage.getItem("roletype"),a=new URLSearchParams;1!=t&&a.append("companyid",sessionStorage.getItem("companyid")),this.$axios.post("/api/company/getcompanylist",a).then(function(t){t.data.data.forEach(function(t){1==t.isvalid&&e.companylist.push({label:t.companyname,key:t.id,value:t.id})})})}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("添加设备")]),e._v(" "),a("div",{staticStyle:{"text-align":"left"}},[a("p",[a("span",{staticClass:"mytitle"},[e._v("设备名")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备名"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("设备描述")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备描述"},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("所属公司")]),e._v(" "),a("el-select",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{clearable:"",placeholder:"请选择所属公司"},model:{value:e.companyid,callback:function(t){e.companyid=t},expression:"companyid"}},e._l(e.companylist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("标签")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备标签"},model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}}),e._v(" "),a("span",{staticClass:"notice"},[e._v("不同标签请用逗号隔开")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("经度")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备经度"},model:{value:e.lon,callback:function(t){e.lon=t},expression:"lon"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("纬度")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备纬度"},model:{value:e.lat,callback:function(t){e.lat=t},expression:"lat"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("是否私有")]),e._v(" "),a("el-select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请选择状态"},model:{value:e.private_str,callback:function(t){e.private_str=t},expression:"private_str"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("鉴权字符串")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入鉴权字符串"},model:{value:e.auth_info,callback:function(t){e.auth_info=t},expression:"auth_info"}}),e._v(" "),a("span",{staticClass:"notice"},[e._v("设备间不能设置相同的字符串，最多512个字母、数字或字母与数字组合的字符串。")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle"},[e._v("其他")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备其他信息"},model:{value:e.other_str,callback:function(t){e.other_str=t},expression:"other_str"}}),e._v(" "),a("span",{staticClass:"notice"},[e._v("请输入json格式的字符串")])],1)]),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:function(t){e.handleSummit()}}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-caret-left"},on:{click:function(t){e.handleback()}}},[e._v("返回")])],1)])},staticRenderFns:[]};var H={data:function(){return{dto:{}}},methods:{handleBack:function(){this.$router.go(-1)}},created:function(){var e=this;this.row=this.$route.query.row;var t="";""!=this.row.id&&null!=this.row.id&&void 0!=this.row.id?(sessionStorage.setItem("device_id",this.row.id),t=this.row.id):t=sessionStorage.getItem("device_id"),this.$axios.get("/iot/devices/"+t).then(function(t){console.log(t),e.dto=t.data.data})}},X={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("p",[a("span",{staticClass:"mytitlec"},[e._v("设备ID："+e._s(e.dto.id))])]),e._v(" "),a("p",[a("span",{staticClass:"mytitlec"},[e._v("设备名："+e._s(e.dto.title))])]),e._v(" "),a("p",[a("span",{staticClass:"mytitlec"},[e._v(" 状态 ：")]),e._v(" "),e.dto.online?a("i",{staticClass:"fa fa-circle",staticStyle:{"font-size":"20px",color:"green"}}):e._e(),e._v(" "),e.dto.online?a("span",{staticClass:"mytitlec"},[e._v("在线")]):e._e(),e._v(" "),e.dto.online?e._e():a("i",{staticClass:"fa fa-circle",staticStyle:{"font-size":"20px",color:"red"}}),e._v(" "),e.dto.online?e._e():a("span",{staticClass:"mytitlec"},[e._v("离线")])]),e._v(" "),a("p",[a("span",{staticClass:"mytitlec"},[e._v("创建时间："+e._s(e.dto.create_time))])]),e._v(" "),a("p",[a("span",{staticClass:"mytitlec"},[e._v("描述："+e._s(e.dto.desc))])]),e._v(" "),a("p",[a("span",{staticClass:"mytitlec"},[e._v("认证字符串："+e._s(e.dto.auth_info))])]),e._v(" "),a("p",[a("span",{staticClass:"mytitlec"},[e._v(" 是否私有 ：")]),e._v(" "),e.dto.private?a("span",{staticClass:"mytitlec"},[e._v("私有")]):e._e(),e._v(" "),e.dto.private?e._e():a("span",{staticClass:"mytitlec"},[e._v("公有")])]),e._v(" "),a("p",[a("span",{staticClass:"mytitlec"},[e._v("协议："+e._s(e.dto.protocol))])]),e._v(" "),void 0!=e.dto.location?a("p",[a("span",{staticClass:"mytitlec"},[e._v("经度："+e._s(e.dto.location.lat)+" ,")]),e._v(" "),a("span",{staticClass:"mytitlec"},[e._v("纬度："+e._s(e.dto.location.lon))])]):e._e(),e._v(" "),void 0!=e.dto.datastreams&&0!=e.dto.datastreams.size?a("p",[a("span",{staticClass:"mytitlec"},[e._v("数据流：")]),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.dto.datastreams,stripe:""}},[a("el-table-column",{attrs:{prop:"id",label:"数据流ID",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unit",label:"单位",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unit_symbol",label:"单位符号",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}})],1)],1):e._e(),e._v(" "),a("p",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"success",icon:"el-icon-arrow-left"},on:{click:function(t){e.handleBack()}}},[e._v("返回")])],1)])},staticRenderFns:[]};var Q={data:function(){return{companylist:[],companyid:"",device_id:"",title:"",desc:"",tags:"",lon:-1,lat:-1,private_str:"",options:[{value:"1",label:"私有"},{value:"0",label:"公有"}],auth_info:"",auth_info_old:"",other_str:""}},methods:{handleSummit:function(){console.log("进入提交");var e=this,t=this.checkvalues();console.log(t),t.then(function(t){console.log("resolve:"+t),e.updatedevice()},function(e){console.log(e)}).catch(function(e){console.log(e)})},updatedevice:function(){var e=this;console.log("进入updatedevice");var t=[],a={},s={},i={},n=!0;""!=this.tags&&null!=this.tags&&void 0!=this.tags&&(t=this.tags.split(",")),-1==this.lon&&-1==this.lat||(a.lon=this.lon,a.lat=this.lat),n="0"!=this.private_str,console.log(this.other_str);var o=this.other_str.replace(/\s+/g,"");""!=o&&null!=o&&void 0!=o&&(s=JSON.parse(this.other_str)),i.title=this.title,i.desc=this.desc,i.tags=t,i.private=n,0!=q()(a).length&&(i.location=a),""!=this.auth_info&&this.auth_info_old!=this.auth_info&&(i.auth_info=this.auth_info),i.other=s,this.$confirm("是否确认更新","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios({method:"put",url:"/iot/devices/"+e.device_id,data:i}).then(function(t){"succ"==t.data.error?e.$message({type:"success",message:"更新成功"}):e.$message({type:"error",message:"添加失败："+t.data.error})})}).catch(function(){e.$message({type:"info",message:"取消"})})},handleback:function(){this.$router.go(-1)},checkvalues:function(){var e=this.other_str.replace(/\s+/g,"");return""==this.title||null==this.title||void 0==this.title?(this.$message({type:"error",message:"请填入设备名"}),console.log("第一条"),i.a.reject(-1)):""==e||null==e||void 0==e||this.isJSON(this.other_str)?i.a.resolve(1):(this.$message({type:"error",message:"输入非json格式，请输入正确的格式"}),i.a.reject(-1))},isJSON:function(e){if("string"==typeof e)try{var t=JSON.parse(e);return!("object"!=(void 0===t?"undefined":K()(t))||!t)}catch(t){return console.log("error："+e+"!!!"+t),!1}console.log("It is not a string!")}},created:function(){var e=this;this.row=this.$route.query.row;var t="";""!=this.row.id&&null!=this.row.id&&void 0!=this.row.id?(sessionStorage.setItem("device_id",this.row.id),t=this.row.id):t=sessionStorage.getItem("device_id"),this.$axios.get("/iot/devices/"+t).then(function(t){var a=t.data.data;if(void 0!=a.id&&(e.device_id=a.id),void 0!=a.title&&(e.title=a.title),void 0!=a.desc&&(e.desc=a.desc),void 0!=a.tags)for(var s=0;s<a.tags.length;s++)s<a.tags.length-1?e.tags+=a.tags[s]+",":e.tags+=a.tags[s];void 0!=a.location&&0!=q()(a.location).length&&(e.lon=a.location.lon,e.lat=a.location.lat),a.private&&void 0!=a.private&&(e.private_str="1"),a.private||void 0==a.private||(e.private_str="0"),void 0!=a.auth_info&&(e.auth_info=a.auth_info,e.auth_info_old=a.auth_info),void 0!=a.other&&0!=q()(a.other).length&&(e.other_str=v()(a.other))}),this.$axios.post("/api/company/getcompanylist").then(function(t){t.data.data.forEach(function(t){1==t.isvalid&&e.companylist.push({label:t.companyname,key:t.id,value:t.id})})});var a=new URLSearchParams;a.append("deviceid",t),this.$axios.post("/api/device/getcompanyidbydeviceid",a).then(function(t){e.companyid=t.data.data})}},Y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"text-align":"left"}},[a("p",[a("span",{staticClass:"mytitle2"},[e._v("设备ID")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备ID",disabled:!0},model:{value:e.device_id,callback:function(t){e.device_id=t},expression:"device_id"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("设备名")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备名"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("设备描述")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备描述"},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("所属公司")]),e._v(" "),a("el-select",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{clearable:"",placeholder:"请选择所属公司"},model:{value:e.companyid,callback:function(t){e.companyid=t},expression:"companyid"}},e._l(e.companylist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("标签")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备标签"},model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}}),e._v(" "),a("span",{staticClass:"notice2"},[e._v("不同标签请用逗号隔开")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("经度")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备经度"},model:{value:e.lon,callback:function(t){e.lon=t},expression:"lon"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("纬度")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备纬度"},model:{value:e.lat,callback:function(t){e.lat=t},expression:"lat"}})],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("是否私有")]),e._v(" "),a("el-select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请选择状态"},model:{value:e.private_str,callback:function(t){e.private_str=t},expression:"private_str"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("鉴权字符串")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入鉴权字符串"},model:{value:e.auth_info,callback:function(t){e.auth_info=t},expression:"auth_info"}}),e._v(" "),a("span",{staticClass:"notice2"},[e._v("设备间不能设置相同的字符串，最多512个字母、数字或字母与数字组合的字符串。")])],1),e._v(" "),a("p",[a("span",{staticClass:"mytitle2"},[e._v("其他")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备其他信息"},model:{value:e.other_str,callback:function(t){e.other_str=t},expression:"other_str"}}),e._v(" "),a("span",{staticClass:"notice2"},[e._v("请输入json格式的字符串")])],1)]),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:function(t){e.handleSummit()}}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-caret-left"},on:{click:function(t){e.handleback()}}},[e._v("返回")])],1)])},staticRenderFns:[]};var W=[{path:"/device",name:"设备管理",component:u,iconCls:"fa fa-server",meta:{permission:"device:add|device:delete|device:update|device:view|device:cmd"},leaf:!1,children:[{path:"/device/devicelist",component:A,meta:{permission:"device:view"},name:"设备列表"},{path:"/device/sendcmd",component:B,name:"发送命令",hidden:!0},{path:"/device/adddevice",component:a("VU/8")(J,T,!1,function(e){a("Sxr5")},null,null).exports,name:"添加设备",hidden:!0},{path:"/device/dto",component:a("VU/8")(H,X,!1,function(e){a("su2t")},"data-v-1e7acc14",null).exports,name:"设备详情",hidden:!0},{path:"/device/edit",component:a("VU/8")(Q,Y,!1,function(e){a("E4S+")},null,null).exports,name:"编辑设备",hidden:!0}]}];function Z(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var s in a)if(new RegExp("("+s+")").test(t)){var i=a[s]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?i:G(i))}return t}function G(e){return("00"+e).substr(e.length)}var ee={data:function(){return{device_id:"",count:"",receive:{},msg:""}},methods:{sreach:function(){var e=this;this.msg="",console.log("点击搜索按钮");var t=new URLSearchParams;""!=this.device_id&&null!=this.device_id&&void 0!=this.device_id&&t.append("device_id",this.device_id),this.$axios({method:"post",url:"/api/receive/getcache",params:t}).then(function(t){0==t.data.code&&(e.receive=t.data.data,console.log(e.receive),e.$message({type:"success",message:"获取设备上传信息成功"})),e.receive.forEach(function(t,a){2==t.type&&0==t.status&&(e.msg+=Z(new Date(t.at),"yyyy-MM-dd hh:mm:ss")+":  设备ID："+t.dev_id+" 下线.......<br>"),2==t.type&&1==t.status&&(e.msg+=Z(new Date(t.at),"yyyy-MM-dd hh:mm:ss")+":  设备ID："+t.dev_id+" 上线.......<br>"),1==t.type&&(e.msg+=Z(new Date(t.at),"yyyy-MM-dd hh:mm:ss")+":  设备ID："+t.dev_id+" 发送消息："+t.value+" 数据流:"+t.ds_id+"<br>"),7==t.type&&1==t.cmd_type&&(e.msg+=Z(new Date(t.at),"yyyy-MM-dd hh:mm:ss")+":  设备ID："+t.dev_id+" 缓存命令下发后设备收到cmd的ACK响应信息:"+t.confirm_body+" confirm_time:"+new Date(t.confirm_time)+" send_status:"+t.send_status+" send_time:"+new Date(t.send_time)+" send_status:"+t.send_status+" cmd_id:"+t.cmd_id+" imei:"+t.imei+" cmd_type:"+t.cmd_type+"<br>"),7==t.type&&1==t.cmd_type&&(e.msg+=Z(new Date(t.at),"yyyy-MM-dd hh:mm:ss")+":  设备ID："+t.dev_id+" 缓存命令下发后设备收到cmd的Confirm响应信息:"+t.confirm_body+" confirm_time:"+new Date(t.confirm_time)+" send_status:"+t.send_status+" send_time:"+new Date(t.send_time)+" send_status:"+t.send_status+" cmd_id:"+t.cmd_id+" imei:"+t.imei+" cmd_type:"+t.cmd_type+"<br>")})})}}},te={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("接收器")]),e._v(" "),a("p",[a("span",{staticClass:"receivertitle"},[e._v("设备ID：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入设备号",clearable:""},model:{value:e.device_id,callback:function(t){e.device_id=t},expression:"device_id"}}),e._v(" "),a("span",{staticStyle:{color:"red","font-size":"10px"}},[e._v("默认查询所有设备上传消息（时间倒序），可用*进行模糊查询")])],1),e._v(" "),a("p",[a("span",{staticClass:"receivertitle"},[e._v("查询最大条数：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入条数",clearable:""},model:{value:e.count,callback:function(t){e.count=t},expression:"count"}}),e._v(" "),a("span",{staticStyle:{color:"red","font-size":"10px"}},[e._v("默认为1000")])],1),e._v(" "),a("p",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){e.sreach()}}},[e._v("搜索")])],1),e._v(" "),a("div",{domProps:{innerHTML:e._s(e.msg)}},[e._v("\n         "+e._s(e.msg)+"\n     ")])])},staticRenderFns:[]};var ae=[{path:"/receiver",name:"接收器管理",component:u,iconCls:"fa fa-microchip",leaf:!1,meta:{permission:"receiver:view"},children:[{path:"/receiver/receiver",meta:{permission:"receiver:view"},component:a("VU/8")(ee,te,!1,function(e){a("muEm")},"data-v-195eae68",null).exports,name:"接收器"}]}];n.default.use(r.a);var se=[{path:"/main",component:u,hidden:!0,redirect:"/dashboard",name:"主页面",children:[{path:"/dashboard",component:c.default,name:"首页"}]}];for(var ie in se.push({path:"/login",name:"登录",component:f,hidden:!0}),F)se.push(F[ie]);for(var ne in W)se.push(W[ne]);for(var oe in ae)se.push(ae[oe]);var le=new r.a({scrollBehavior:function(){return{y:0}},routes:se});le.beforeEach(function(e,t,a){var s=sessionStorage.getItem("userid_login"),i=g.getters.getisloginById(s);null!=i&&i.islogin&&void 0!=i&&void 0!=i.islogin&&void 0!=i.id?"/login"==e.path||"/"==e.path?(alert("您已经登录，不能跳转至登录页，若需重新登录请关闭浏览器或注销用户"),a("/main")):a():"/login"==e.path?a():a("/login")});var re=le,ce=(a("tvR6"),a("zL8q")),de=a.n(ce),pe=a("mtWM"),ue=a.n(pe);a("e0XP");ue.a.defaults.headers.post["Content-Type"]="application/json",ue.a.defaults.headers.common.Accept="application/json",ue.a.defaults.headers.common["api-key"]="=KOsIOm9hXPXCf8gaf92oKUsJyU=",n.default.config.productionTip=!1,n.default.use(de.a),n.default.use("Message"),n.default.prototype.$axios=ue.a,ue.a.interceptors.response.use(function(e){return void 0!=e.data.code&&1001==e.data.code?(n.default.prototype.$message({type:"error",message:e.data.msg}),sessionStorage.clear(),re.push({path:"/login"}),i.a.reject(e.data.msg)):void 0!=e.data.errno&&0!=e.data.errno?(n.default.prototype.$message({type:"error",message:e.data.error}),i.a.reject(e.data.error)):e},function(e){return n.default.prototype.$message({type:"error",time:"5000",message:e}),i.a.reject(e)}),n.default.directive("hasPermission",{bind:function(e,t,a){var s=JSON.parse(sessionStorage.getItem("permissionStr")),i=!0;if(void 0==t.value||""==t.value)i=!1;else if(s&&s.length){var n,o=t.value.split("|");for(n in o)if(s.includes(o[n])){i=!1;break}}i&&e.parentNode.removeChild(e)}}),new n.default({el:"#app",router:re,store:g,template:"<App/>",components:{App:l}})},QJKX:function(e,t,a){"use strict";var s={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("h1",{attrs:{id:"home"}},[this._v("欢迎使用物联网系统")])])}]};t.a=s},R3oS:function(e,t){},RBB8:function(e,t){},Sxr5:function(e,t){},TGvd:function(e,t,a){"use strict";var s=a("aEfQ"),i=a.n(s),n=a("QJKX");var o=function(e){a("BwtD")},l=a("VU/8")(i.a,n.a,!1,o,null,null);t.default=l.exports},XMWq:function(e,t){},aEfQ:function(e,t){},b6Z5:function(e,t){},e0XP:function(e,t){},iLAA:function(e,t){},muEm:function(e,t){},npDf:function(e,t){},ntd3:function(e,t){},nyQt:function(e,t){},"sg/Y":function(e,t){},su2t:function(e,t){},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.6b338b7fea429b355458.js.map